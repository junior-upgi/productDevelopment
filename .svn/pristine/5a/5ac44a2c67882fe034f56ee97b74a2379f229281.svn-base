<?php $__env->startSection('project', 'active'); ?>
<?php $__env->startSection('content'); ?>
    <script src="<?php echo e(url('/')); ?>/js/Product/ProductList.js?x=3"></script>
    <!--breadcrumb-->
    <ol class="breadcrumb">
        <li><a href="<?php echo e(url('/')); ?>/Project/ProjectList">開發案清單</a></li>
        <li class="active">開發產品清單</li>
    </ol>
    <!--project info panel-->
    <p class="bg-info">
        <span style="margin-right:20px;">專案代碼：<?php echo e($ProjectData->referenceNumber); ?></span>
        <span style="margin-right:20px;">專案名稱：<?php echo e($ProjectData->referenceName); ?></span>
        <span style="margin-right:20px;">客戶名稱：<?php echo e($ProjectData->clientName); ?></span>
        <span style="margin-right:20px;">業務員：<?php echo e($ProjectData->salesName); ?></span>   
    </p>
    <!--tool bar-->
    <?php 
        Auth::user()->authorization === '1' ? $UserRole = ' disabled' : $UserRole='';
     ?>
    <nav class="navbar navbar-default" role="navigation">
        <ul class="nav navbar-nav">
            <form action="" class="navbar-form">
                <a href="<?php echo e(url('/')); ?>/Project/ProjectList" class="btn btn-default">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                </a>
                <a href="<?php echo e(url('/')); ?>/Product/AddProduct/<?php echo e($ProjectData->ID); ?>" class="btn btn-primary <?php echo e($UserRole); ?>"><span class="glyphicon glyphicon-plus">新增</span></a>
            </form>
        </ul>
    </nav>
    <!--data table-->
    <table class="table table-bordered" style="margin-top:20px;">
        <thead>
            <tr>
                <td width=60></td>
                <td width=60></td>
                <td width=140>產品代號</td>
                <td>產品名稱</td>
                <td width=80>需求數量</td>
                <td width=80>交貨數量</td>
                <td width=110>工期</td>
                <td width=100>完工期限</td>
                <td width=80 class="text-center">完成時間</td>
                <td width=50></td>
            </tr>
        </thead>
        <tbody>
            <?php 
                use Carbon\Carbon;
                $Now = strtotime(Carbon::now() . '-1 day');
             ?>
            <?php $__currentLoopData = $ProductList; $__env->addLoop($__currentLoopData); foreach($__currentLoopData as $list): $__env->incrementLoopIndices(); $loop = $__env->getFirstLoop(); ?>
                <tr>
                    <td><a href="<?php echo e(url('/')); ?>/Product/EditProduct/<?php echo e($list->ID); ?>" class="btn btn-sm btn-default <?php echo e($UserRole); ?>"><span class="glyphicon glyphicon-edit"></span></a></td>
                    <td><a href="<?php echo e(url('/')); ?>/Process/ProcessList/<?php echo e($list->ID); ?>" class="btn btn-sm btn-info">時程</a></td>
                    <td><?php echo e($list->referenceNumber); ?></td>
                    <td><?php echo e($list->referenceName); ?></td>
                    <td class="text-right"><?php echo e($list->requiredQuantity); ?></td>
                    <td class="text-right"><?php echo e($list->deliveredQuantity); ?></td>
                    <td>
                        <?php if(isset($list->startDate)): ?>
                            <?php echo e(date('Y-m-d', strtotime($list->startDate))); ?>

                            ~
                            <?php echo e(date('Y-m-d', strtotime($list->endDate))); ?>

                        <?php endif; ?>
                    </td>
                    <td><?php echo e(date('Y-m-d', strtotime($list->deadline))); ?></td>
                    <td class="text-center">
                        <?php  
                            $Status = "";
                            if (($list->execute === '1') && ($list->productStatus === '0')) {
                                if (strtotime($list->nowEndDate) < $Now) {
                                    $Status = "label label-warning";
                                }
                                if (strtotime($list->deadline) < $Now) {
                                    $Status = "label label-danger";
                                }
                            }
                         ?>
                        <?php if($list->productStatus === '1'): ?>
                            <span class="<?php echo e($Status); ?>">尚未開始</span>
                        <?php elseif($list->productStatus === '0'): ?>
                            <span class="<?php echo e($Status); ?>">進行中</span>
                        <?php elseif($list->productStatus === '2'): ?>
                            <?php  
                                if (strtotime($list->maxCompleteTime) <= strtotime($list->deadline)) {
                                    $class = "label label-success";
                                } else {
                                    $class = "label label-danger";
                                }
                             ?>
                            <span class="<?php echo e($class); ?>"><?php echo e(date('Y-m-d', strtotime($list->maxCompleteTime))); ?></span>
                        <?php endif; ?>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-danger <?php echo e($UserRole); ?>" onclick="DoDelete('<?php echo e($ProjectData->ID); ?>', '<?php echo e($list->ID); ?>')"><span class="glyphicon glyphicon-trash"></span></button>
                    </td>
                </tr>
            <?php endforeach; $__env->popLoop(); $loop = $__env->getFirstLoop(); ?>
        </tbody>
    </table>
    <div class="text-center">
        <?php echo e($ProductList->links()); ?>

    </div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layouts.masterpage', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>