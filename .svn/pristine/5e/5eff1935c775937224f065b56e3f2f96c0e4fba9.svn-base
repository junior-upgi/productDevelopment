<?php $__env->startSection('content'); ?>
    <link rel="stylesheet" type="" href="<?php echo e(url('/')); ?>/css/Process/ProcessList.css">
    <script src="<?php echo e(url('/')); ?>/js/Process/ProcessList.js?x=1"></script>
    <!--breadcrumb-->
    <ol class="breadcrumb">
        <li><a href="<?php echo e(url('/')); ?>/Project/ProjectList">開發案清單</a></li>
        <li><a href="<?php echo e(url('/')); ?>/Product/ProductList/<?php echo e($ProductData->projectID); ?>">開發產品清單</a></li>
        <li class="active">產品開發流程</li>
    </ol>
    <!--product info panel-->
    <?php /**/ 
        $Deadline = strtotime($ProductData->deadline) 
    /**/ ?>
    <p class="bg-info">
        <span style="margin-right:20px;">產品代碼：<?php echo e($ProductData->referenceNumber); ?></span>
        <span style="margin-right:20px;">產品名稱：<?php echo e($ProductData->referenceName); ?></span>
        <span style="margin-right:20px;">需求數量：<?php echo e($ProductData->requiredQuantity); ?></span>
        <span style="margin-right:20px;">交貨期限：<?php echo e(date('Y-m-d', $Deadline)); ?></span>   
    </p>
    <!--tool bar-->
    <nav class="navbar navbar-default" role="navigation">
        <ul class="nav navbar-nav">
            <form action="" class="navbar-form">
                <a href="<?php echo e(url('/')); ?>/Product/ProductList/<?php echo e($ProductData->projectID); ?>" class="btn btn-default">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                </a>
                <button type="button" class="btn btn-primary" onclick="AddShow()">新增</button>
                <button type="button" class="btn btn-warning" onclick="SaveSort()">儲存排序</button>
                <?php if($ProductData->execute == "0"): ?>
                    <button type="button" class="btn btn-warning" onclick="Execute()">執行開發</button>
                <?php else: ?>
                    <button type="button" class="btn btn-warning disabled" onclick="Execute()">開發執行中...</button>
                <?php endif; ?>
            </form>
        </ul>
    </nav>
    <input type="hidden" id="ProductID" name="ProductID" value="<?php echo e($ProductData->ID); ?>">
    <table class="table table-bordered">
        <thead>
            <tr>
                <td width="60"></td>
                <td>#</td>
                <td class="text-center">類別</td>
                <td>代號</td>
                <td>名稱</td>
                <td>負責人</td>
                <td class="col-md-1">工時</td>
                <td width="200">工期</td>
                <td width="100" class="text-center">完成時間</td>
                <td width="60"></td>
            </tr>
        </thead>
        <tbody id="tableSort">
            <?php /**/ 
                $CostCount = 0;
                $i = 1;
                use Carbon\Carbon;
                $Now = strtotime(Carbon::now() . '-1 day');
            /**/ ?>
            <?php foreach($ProcessList as $list): ?>
                <?php /**/ 
                    $StartDays = $CostCount;
                    $EndDays = ($CostCount += $list->timeCost) - 1;
                    $StartDate = strtotime($ProductData->startDate . '+' . $StartDays . ' day');
                    $EndDate = strtotime($ProductData->startDate . '+' . $EndDays . ' day') 
                /**/ ?>
                <?php if($list->complete == "0"): ?>
                    <tr id="<?php echo e($list->ID); ?>">
                <?php else: ?>
                    <tr id="<?php echo e($list->ID); ?>" class="ui-state-disabled">
                <?php endif; ?>
                    <td>
                        <button type="button" class="btn btn-sm btn-default" onclick="EditShow('<?php echo e($list->ID); ?>')">編輯</button>
                    </td>
                    <td><?php echo e($i++); ?></td>
                    <td class="text-center">
                        <span><?php echo e($list->PhaseName); ?></span>
                    </td>
                    <td>
                        <span><?php echo e($list->referenceNumber); ?></span>
                    </td>
                    <td>
                        <span><?php echo e($list->referenceName); ?></span>
                    </td>
                    <td>
                        <span><?php echo e($list->NodeName); ?></span>
                        <span><?php echo e($list->name); ?></span>
                    </td>
                    <td>
                        <span><?php echo e($list->timeCost); ?></span>
                    </td>
                    <td>
                        <?php if($StartDate > $Deadline): ?>
                            <span class="label label-danger">
                                <?php echo e(date('Y-m-d', $StartDate)); ?>

                            </span>
                        <?php else: ?>
                            <span>
                                <?php echo e(date('Y-m-d', $StartDate)); ?>

                            </span>
                        <?php endif; ?>
                        <span>~</span>
                        <?php if($EndDate > $Deadline): ?>
                            <span class="label label-danger">
                                <?php echo e(date('Y-m-d', $EndDate)); ?>

                            <span>
                        <?php else: ?>
                            <span>
                                <?php echo e(date('Y-m-d', $EndDate)); ?>

                            <span>
                        <?php endif; ?> 
                    </td>
                    <td class="text-center">
                        <?php if($list->complete == "0"): ?>
                            <?php if($Now > $Deadline): ?>
                                <button type="button" class="btn btn-sm btn-danger" onclick="Complete('<?php echo e($list->ID); ?>')">完成</button>
                            <?php elseif($Now > $EndDate): ?>
                                <button type="button" class="btn btn-sm btn-warning" onclick="Complete('<?php echo e($list->ID); ?>')">完成</button>
                            <?php else: ?>
                                <button type="button" class="btn btn-sm btn-default" onclick="Complete('<?php echo e($list->ID); ?>')">完成</button>
                            <?php endif; ?>
                        <?php else: ?>
                            <?php /**/ 
                                $CompleteDate = strtotime($list->completeTime . '-1 day') 
                            /**/ ?>
                            <?php if($CompleteDate > $Deadline): ?>
                                <span class="label label-danger">
                                    <?php echo e(date('Y-m-d', strtotime($list->completeTime))); ?>

                                </span>
                            <?php elseif($CompleteDate > $EndDate): ?>
                                <span class="label label-warning">
                                    <?php echo e(date('Y-m-d', strtotime($list->completeTime))); ?>

                                </span>
                            <?php else: ?>
                                <span class="label label-success">
                                    <?php echo e(date('Y-m-d', strtotime($list->completeTime))); ?>

                                </span>
                            <?php endif; ?>
                        <?php endif; ?>
                    </td>
                    <td>
                        <button type="button" class="btn btn-sm btn-danger">刪除</button>
                    </td>
                </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
   
    <?php echo $__env->make('Process.AddProcess', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
    <?php echo $__env->make('Process.EditProcess', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layouts.masterpage', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>